- name: Install epel-release
  yum:
   name: "epel-release"
   state: present
  when: epel
 
- name: Ensure epel is not installed
  yum:
   name: "epel-release"
   state: absent
  when: not epel

- name: Install a base package with yum
  yum:
   name: "{{ item }}"
   state: present
  with_items: "{{ packages }}"
  when: epel

- name: Disable SELinux
  selinux: 
    state: disabled
  when: "ansible_virtualization_type != 'openvz' and ansible_virtualization_type != 'lxc'"

- name: "Update all packages"
  yum:
    name: '*'
    state: latest
  when: update

- name: Install open-vm-tools for CentOS Distro
  yum:
    name: open-vm-tools
    state: present
  when: ansible_virtualization_type == 'VMWare'
